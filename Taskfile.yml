# https://taskfile.dev

version: '3'

dotenv: ['.env']

vars:
  CWD:
    sh: git rev-parse --show-toplevel
  DIST:
    "{{.CWD}}/.dist"

tasks:
  default:
    cmds:
      - task: demo

  demo:
    desc: Run the smugmug demo
    cmds:
      - go run cmd/demo/*.go {{.CLI_ARGS}}

  test:
    desc: Run tests
    cmds:
      - mkdir -p {{.DIST}}
      - go test -count=1 -covermode count -coverprofile {{.DIST}}/coverage.txt github.com/bzimmer/smugmug github.com/bzimmer/smugmug/uploadable/filesystem

  cover:
    desc: Visualize test coverage
    deps: [test]
    cmds:
      - go tool cover -html={{.DIST}}/coverage.txt
